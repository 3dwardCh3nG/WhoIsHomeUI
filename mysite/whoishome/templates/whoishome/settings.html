{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}

{% if messages %}

<script type="text/javascript">
    window.onload = function() {
        var toastLiveExample = document.getElementById('liveToast');
        var toast = new bootstrap.Toast(toastLiveExample);
        toast.body = "what";
        toast.show();
        };


</script>
{% for message in messages %}
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div aria-atomic="true" aria-live="assertive" class="toast bg-success text-white" id="liveToast" role="alert">
        <div class="toast-header bg-success text-white">
            <strong class="me-auto">{% if message.extra_tags %} {{message.extra_tags}} {% endif %}</strong>
            <small class="text-white"><i class="bi bi-clock"></i> Now</small>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="toast" type="button"></button>
        </div>
        <div class="toast-body">
            {{ message | safe }}
        </div>
    </div>
</div>
{% endfor %}

{% endif %}


<h3>Settings</h3>
<!-- Rounded switch -->

<div class="btn-group btn-group-toggle" data-toggle="buttons">
    <label class="btn btn-{% if scanner_running %}success{% else %}danger{% endif %} active" id="scannerButton">Scanner
        Status
        <input %} %} checked endif id="startstop" if onclick="scannerSwitch()" scanner_running type="checkbox" {% {%>
    </label>
</div>

<br/>
<br/>
<p>
    <button aria-controls="collapseExample" aria-expanded="false" class="btn btn-primary" data-bs-target="#scannerModal"
            data-bs-toggle="modal" type="button">
        Scanner Settings
    </button>
</p>

<div class="modal" id="scannerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Email Settings</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'settings' %}" method="post">

                    {% csrf_token %}
                    {{ scanner_settings_form | crispy }}
                    <br/>
                    <button class="btn btn-primary" name="update_scanner_settings" type="submit">Save Settings</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                </form>
            </div>
        </div>
    </div>
</div>

<p>
    <button aria-controls="collapseExample" aria-expanded="false" class="btn btn-primary" data-bs-target="#emailModal"
            data-bs-toggle="modal" type="button">
        Email Settings
    </button>
</p>

<div class="modal" id="emailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Email Settings</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                In the email subjects and bodys use can use the following tags to load data into the emails:
                <ul>
                    <li>{target} for the name of the target/host</li>
                    <li>{arrival_time} time the host arrived</li>
                    <li>{departure_time} time the host left</li>
                    <li>{time_home}</li>
                    <li>{time_away}</li>
                </ul>

                <form action="{% url 'settings' %}" method="post">

                    {% csrf_token %}
                    {{ email_settings_form | crispy }}
                    <br/>
                    <button class="btn btn-primary" name="update_email_settings" type="submit">Save Settings</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                </form>
            </div>
        </div>
    </div>
</div>

<p>
    <button aria-controls="collapseExample" aria-expanded="false" class="btn btn-primary" data-bs-target="#discordModal"
            data-bs-toggle="modal" type="button">
        Discord Settings
    </button>
</p>

<div class="modal" id="discordModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Discord Settings</h5>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                In the discord message the following templating tags are available:
                <ul>
                    <li>{target} for the name of the target/host</li>
                    <li>{arrival_time} time the host arrived</li>
                    <li>{departure_time} time the host left</li>
                    <li>{time_home}</li>
                    <li>{time_away}</li>
                </ul>

                <form action="{% url 'settings' %}" method="post">

                    {% csrf_token %}
                    {{ discord_form | crispy }}
                <br/>
                    <button class="btn btn-primary" name="update_email_settings" type="submit">Save Settings</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="modal" id="collapseDiscordSettings">
    <div class="modal-body">
        In the discord message the following templating tags are available:
        <ul>
            <li>{target} for the name of the target/host</li>
            <li>{arrival_time} time the host arrived</li>
            <li>{departure_time} time the host left</li>
            <li>{time_home}</li>
            <li>{time_away}</li>
        </ul>

        <form action="{% url 'settings' %}" method="post">

            {% csrf_token %}
            {{ discord_form | crispy }}
            <div class="modal-footer">
                <br/>
                <button class="btn btn-primary" name="update_discord_settings" type="submit">Save Settings</button>
            </div>
        </form>
    </div>
</div>


<br/>
<br/>
<h4>Console Log</h4>

{% for log in logfile %}
<samp>{{ log }}</samp>
<br/>
{% endfor %}
<script>

    function scannerSwitch() {
        const startStopInput = document.getElementById('startstop');
         var toastLiveExample = document.getElementById('liveToast');
         var toast = new bootstrap.Toast(toastLiveExample);
         var scannerButton = document.getElementById('scannerButton');
        if (startStopInput.checked) {
            view = '/start_scanner';
            toast.show();
            scannerButton.className = 'btn btn-success';
        } else {
            view = '/stop_scanner';
            toast.show();
            scannerButton.className = 'btn btn-danger';
        }
        $.get(view,)
    };




</script>

{% endblock content %}
